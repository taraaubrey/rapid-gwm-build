# TODO
# - how does Simulation know that it needs a discretization module?
# - how does Simulation know what a tdis module is?
write:
    0: {func: ['@module.sim.', 'set_all_data_external']}
    1: {func: ['@module.sim.', 'write_simulation']}

module_templates:
    obs:
        func: 'flopy.mf6.modflow.mfutlobs'
        duplicates_allowed: True
        build_dependencies: 
            model: '@module.gwf.' # referencing {modules.gwf..output}
    
    sim:
        func: 'flopy.mf6.MFSimulation'
        duplicates_allowed: False
        default_build:
            allowed: True

    tdis:
        build_dependencies: 
            simulation: '@module.sim.'
        # parameters:
        #     period_data: ['nper', 'perlen', 'nstp', 'steady'] #TODO: this is a special list of adjustable parameters which are not explicitly called
        func: 'flopy.mf6.ModflowTdis'
        duplicates_allowed: False
        default_build:
            allowed: True
            parameters:
                time_units: 'days'
                start_date_time: '2020-01-01'
                nper: 1
                perioddata:
                    - [1., 1, 1.] # perlen, nstp, tsmult

    ims:
        build_dependencies: 
            simulation: '@module.sim.'
        func: 'flopy.mf6.ModflowIms'
        duplicates_allowed: False
        default_build:
            allowed: True


    ## GWF packages ----------------------
    gwf:
        build_dependencies: 
            simulation: '@module.sim.'
        func: 'flopy.mf6.ModflowGwf'
        duplicates_allowed: True
        default_build:
            allowed: True

    npf: 
        build_dependencies: 
            model: '@module.gwf.' # referencing {modules.gwf..output}
        func: 'flopy.mf6.ModflowGwfnpf'
        duplicates_allowed: True
        default_build:
            allowed: True

    dis:
        build_dependencies: 
            model: '@module.gwf.'
            top: '@mesh.top'
            botm: '@mesh.botm'
            idomain: '@mesh.active_domain'
        func: 'flopy.mf6.ModflowGwfdis'
        duplicates_allowed: False
        default_build:
            allowed: True

    ic: 
        build_dependencies: 
            model: '@module.gwf.'
        func: 'flopy.mf6.ModflowGwfic'
        duplicates_allowed: False

    sto: 
        build_dependencies: 
            model: '@module.gwf.'
        func: 'flopy.mf6.ModflowGwfsto'
        duplicates_allowed: False
    
## Simple stress packages ----------------------

    wel:
        build_dependencies: 
            model: '@module.gwf.'
        func: 'flopy.mf6.ModflowGwfwel'
        duplicates_allowed: True


    drn: 
        build_dependencies: 
            model: '@module.gwf.'
            stressperioddata:
                pipes:
                    - stress_period_data: [data.drn..cond, data.drn..elev]
        data:
            cond: #output -> @data.drn.<name_mod>.cond
                pipes:
                    - discretize_2D: #pipeline_name: {input: [input1, input2], kwargs: {kwarg1: value1, kwarg2: value2}}
                        input: [input.modules.drn..cond]
                        kwargs: null #placeholder for future kwargs
            elev:
                pipes:
                    - discretize_2D:
                        input: [input.modules.drn..elev]
        func: flopy.mf6.ModflowGwfdrn
        duplicates_allowed: True


    ghb:
        build_dependencies: 
            model: '@module.gwf.'          
        func: 'flopy.mf6.ModflowGwfghb'
        duplicates_allowed: True

    rcha:
        build_dependencies: 
            model: '@module.gwf.'
        func: 'flopy.mf6.ModflowGwfrcha'
        duplicates_allowed: True
    
    rch:
        build_dependencies: 
            model: '@module.gwf.'
        func: 'flopy.mf6.ModflowGwfrch'
        duplicates_allowed: True


    # ??
    sfr:
        build_dependencies: 
            model: '@module.gwf.'
        func: 'flopy.mf6.ModflowGwfsfr'
        duplicates_allowed: True

    oc:
        build_dependencies: 
            model: '@module.gwf.'
        func: 'flopy.mf6.ModflowGwfoc'
        duplicates_allowed: True